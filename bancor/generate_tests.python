import os
# This is for use on the testnet only. This script asks for an account's public key and password. This script is only for testing and should never be used on a production network or in conjunction with anything of value. Testing only!

# This python script compiles your smart contract, and then generates a javascript file filled with prewritten function calls to the contract so that you can deploy and test your contract without having to do everything by hand. This is useful if you want to change the smart contract code, recompile and quickly test, again and again.

# 1. Install Lity using the following commands

#cd ~
#git clone https://github.com/CyberMiles/lity.git
#cd lity
#mkdir build
#cd build
#cmake ..
#make

# 2. Create an output directory i.e. lity/build/output

# 3. Copy this script to the lity/build directory i.e. lity/build/generate_tests.py

# 4. Paste your contract's name as well as an account's public key as well as its password on the Testnet in the variable below.
sc = "SmartToken"
pubK = "0xab52776885fb487ab60fd10f77604cb5dda4f6f5"
passW = "asdfasdfasdf"

# 5. Type the arguments for your smart contract's constructor in the list below
constructorList = ["timtoken", "tim", "8"]
constructor = ""
for item in constructorList:
    constructor = constructor + "\"" + item + "\"" + ","

# 6. Run this file i.e. cd lity/build and then python3 generate_tests.py

# Working directory
wd = os.getcwd()

# Output directory
od = os.path.join(wd, "output",)

# Compile contract to the output directory
os.chdir(wd)
compileContract = "./lityc/lityc --overwrite --allow-paths ../, --abi --bin -o output/ ~/contracts/solidity/contracts/token/" + sc + ".sol"

os.system(compileContract)

# Writing Javascript style syntax
# Create the js file endpoint
file = open(os.path.join(wd, "output",  sc + "_test.js"), 'w')

# Load the variables with data from the abi and bin files
os.chdir(od)
abi = abiFile = open(sc + ".abi", 'r').read()
bytecode = binFile = open(sc + ".bin",'r').read()
os.chdir(wd)

# Write some data to the output file

file.write("personal.unlockAccount(" + "\"" + pubK + "\"" + ", " + "\"" + passW + "\"" + ");\n")
file.write("var abi = " + abi + ";\n")
file.write("var bytecode = " + "\"" + "0x" + bytecode + "\";\n")
file.write("var newContract = web3.cmt.contract(abi);\n")
file.write("var deployedContract = newContract.new(" + constructor + "{from: " + "\"" + pubK + "\"" + ",data: bytecode, gas:" + "\"" + "5000000" + "\"" + "});\n")
file.close()
