[EOSIO Dawn 3.0]

== Executive summary
This is a deep dive into EOSIO Dawn 3.0. The information in this document is derived from the EOSIO MIT Licensed GitHub documentation and code. The ideas and conclusions in this document are based on the actual results of first hand implementation and testing of the EOSIO software. Real examples are provided, and as such, the verbose content can be found in the appendicies.

== Overview

=== Codebase
EOS expect that C++ will be the best language for developing high-performance and secure smart contracts and therefore EOS plan to use C++ for the foreseeable future.

=== Wallets
An EOS wallet can be thought of as a repository of public-private key pairs. There is no inherent relationship between accounts and wallets. Accounts do not know about wallets, and vice versa.

=== Actions
An action represents a single operation.

=== Transactions
A transaction holds one or more actions for execution; stored in the actions array. Each instance of an action in the actions array has the following key value pairs, account, name, authorization and data.

The combination of actions (sent as transactions) and automated action handlers is how EOSIO defines smart contracts [4].

=== Smart Contracts
Actions can be sent individually, or in combined form if they are intended to be executed as a whole. EOS smart contracts communicate with each other via these transactions. 

=== Accounts
Each account can send structured actions to other accounts and may define scripts to handle actions when they are received. The EOSIO software gives each account its own private database which can only be accessed by its own action handlers.

=== State and scope
An EOS smart contract (contractA) can read the state of another EOS contract (contractB) as long as both contractA and contractB are defined within the read scope of the transaction.

==== The timing of communication between smart contracts
EOS smart contracts have 2 communication modes; inline and deferred, these can both be defined within a given smart contract

Inline:: 
* Guaranteed to execute in the current transaction, or unwind
* Scope and authority is explicitly aligned with the original contract
* No notification of completion
* Nothing is scheduled for future, beyond the current transaction

Deferred::
* Execution set for a time in the future, at a producer’s discretion, but can timeout
* Able to reach out to different scopes as well as carry the authority of the contract that sends them
* Able to communicate the result of the completed communication
* Can be considered scheduled in nature, for future transactions

=== User interaction
EOSIO has a strong focus on the command line at this stage. There are a number of command line programs (executables) which allow users to interact with the blockchain, as well as associated wallets, accounts and so forth.

Programs::
* nodeos - is a server-side blockchain node component. It is located at build/programs/nodeos/nodeos
* keosd - is a component used to *manage* EOSIO wallets and their content. It is located at build/programs/keosd/keosd
* cleos - is a command line interface used to *access* wallets and accounts. cleos also invokes actions on the blockchain. It is located at build/programs/cleos/cleos

There is no inherent relationship between nodeos and keosd, this is logical because there is no inherent relationship between accounts and wallets. cleos effectively serves as an intermediary between keosd key retrieval operations and nodeos account (and other) blockchain actions that require signatures generated using those keys.

image:images/Accounts-and-Wallets-Overview.png[]

For a comprehensive and up to date list of commands, visit this https://github.com/EOSIO/eos/wiki/Command%20Reference[EOS Command Reference link].

=== EOSIO Dawn 3.0 Installation
The following commands can be used to install EOSIO Dawn 3.0 on Ubuntu 16.04LTS, run the EOSIO unit tests as well as add the EOSIO executables to the operating system's path.

Installation::
[source,bash]
----
cd ~
git clone https://github.com/EOSIO/eos.git
cd ~/eos
git submodule update --init --recursive
./eosio_build.sh
----

Tests::
To test the installation, start mongodb and then run the tests in the build directory as per the commands below. The results of the tests should appear as those in this document's Appendix A.

[source,bash]
----
~/opt/mongodb/bin/mongod -f ~/opt/mongodb/mongod.conf &
cd ~/eos/build
make test
----

Program availability::
Run the following command in order to make the EOSIO executables available (installation of executables in /usr/local/bin) in standard $PATH. 

[source,bash]
----
cd ~/eos/build
sudo make install
----

=== Running a single node testnet
The following commands will install and run a single node EOSIO testnet which will immediately commence producing a block every 500ms.

[source,bash]
----
cd ~/eos/build/programs/nodeos
./nodeos -e -p eosio --plugin eosio::wallet_api_plugin --plugin eosio::chain_api_plugin --plugin eosio::account_history_api_plugin 
----

==== Configuration
On Ubuntu, the configuration file (config.ini) and the genesis file (genesis.json) are both found in the .local/share/eosio/nodeos/config folder. In a production settings, nodeos will need a properly configured config.ini file in order to do meaningful work. However if one is not present, such as in this test case, the system will create one by default. The default file which EOSIO creats can be seen in this document's Appendix B.

== Delegated Proof of Stake (DPoS)

== Governance and economics

=== Centralization 
Centralization is the process by which the activities of an organization, particularly those regarding planning and decision-making, become concentrated within a particular location or group [2]. Some argue that the Delegated Proof of Stake (DPoS) consensus mechanism, which EOS uses, is centralized when compared to other consensus mechasisms such as Ethereum's current Proof of Work (PoW). However, others argue against this view with reference to the most recent data from PoW mining pools. The diagram below illustrates the percentage of Ethereum's distributed PoW hashing power. More specifically, how the vast majority of Ethereum's hashing power is spread across only a handful of the most powerful and centralized mining pools in the world [3].
image:images/mining_pools.jpeg[]

=== Block producers
Block producers are an integral part of the EOSIO blockchain implementation and infrastructure. Block producers are also known, in other blockchain circles, as super nodes or validating nodes or master nodes etc. The following section will cover the role of EOSIO block producers in-depth. For example, how block producers become qualified for their position, how token holders vote for block producers, as well as the rewards and consequences for being a good (or bad) block producer on the EOS network. Attack vectors which may threaten block producers will also be covered.

==== Qualification
Monetary::
* Anyone who holds tokens on an EOS network can participate in the production of blocks.
Technically::
* Obviously with the 500ms block times and the fact that block producers will time stamp blocks, it goes without saying that block producers will need to keep extremely accurate system time i.e. employ NTP with continous sync. However, it is unknown at this stage how EOS will enforce the time keeping of block producers.  

==== Voting for block producers
Block producers are elected into their role through a continuous approval voting system which involves, among other things, convincing other token holders to vote for them.

==== Block producer roles and responsibilities
Block producers are randomly ordered to produce the upcoming EOS blocks; there is a fixed schedule which outlines which block producers are responsible for producing specific blocks during a given period of time. Only one block producer at a single point in time can produce the block to which they were assigned. If a block producer goes off line during this time, the block to which they were assigned does not get created. 

==== Rewards and incentives

==== Consequences and punishment
There are certain actions (bad behaviour) which will result in undesirable consequences and potential punishment for a block producer. These include, but are not limited to:
* signing two or more blocks with the same timestamp
* signing two or more blocks with the same blockheight
* being off-line (unavailable) during the scheduled time of block production
Poorly fulfilling one’s role as a block producer will result in economic loss from a) missing the block rewards for the current block and b) future losses due to the fact that they may no longer be able to convince others that they are reliable enough to hold their position as block producer.

==== Disqualification

==== Security

== Scalability
The June 2018 release of EOS.IO software will run single threaded, yet it contains the data structures necessary for future multithreaded, parallel execution [6].

=== Parallel execution
Blockchain consensus depends upon deterministic (reproducible) behavior. This means all parallel execution must be free from the use of mutexes or other locking primitives. Without locks there must be some way to guarantee that transactions that may be executed in parallel do not create non-deterministic results [6].

=== How scope contributes to performance and scalability
To support parallel execution, each account can also define any number of scopes within their database. The block producers will schedule transaction in such a way that there is no conflict over memory access to scopes and therefore they can be executed in parallel [4].

=== Permission evaluation/verification performance
The permission evaluation process is "read-only" and changes to permissions made by transactions do not take effect until the end of a block. This means that all keys and permission evaluation for all transactions can be executed in parallel. Furthermore, this means that a rapid validation of permission is possible without starting costly application logic that would have to be rolled back. Lastly, it means that transaction permissions can be evaluated as pending transactions are received and do not need to be re-evaluated as they are applied. All things considered, permission verification represents a significant percentage of the computation required to validate transactions. Making this a read-only and trivially parallelizable process enables a dramatic increase in performance. [5]. 


== References
////
Source: https://github.com/EOSIO/eos/wiki/Smart-Contract
License: The MIT License (MIT)
Added by: @tpmccallum
////
[1] https://github.com/EOSIO/eos/wiki/Smart-Contract

////
Source: https://en.wikipedia.org/wiki/Centralisation
License: Wikipedia:CC BY-SA
Added by: @tpmccallum
////
[2] https://en.wikipedia.org/wiki/Centralisation

////
Source: https://www.etherchain.org/charts/topMiners
License: TBA
Added by: @tpmccallum
////
[3] https://www.etherchain.org/charts/topMiners

////
Source: https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md#actions--handlers
License: The MIT License (MIT)
Added by: @tpmccallum
////
[4] https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md#actions--handlers

////
Source: https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md#parallel-evaluation-of-permissions
License: The MIT License (MIT)
Added by: @tpmccallum
////
[5] https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md#parallel-evaluation-of-permissions

////
Source: https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md#deterministic-parallel-execution-of-applications
License: The MIT License (MIT)
Added by: @tpmccallum
////
[6] https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md#deterministic-parallel-execution-of-applications

== Appendices

=== Appendix A - results of EOSIO "make test" command in the eos/build directory
[source,bash]
----
Running tests...
Test project /home/timothymccallum/eos_dawn_3/eos/build
      Start  1: test_cypher_suites
 1/31 Test  #1: test_cypher_suites .....................   Passed    0.02 sec
      Start  2: validate_simple.token_abi
 2/31 Test  #2: validate_simple.token_abi ..............   Passed    0.03 sec
      Start  3: validate_eosio.token_abi
 3/31 Test  #3: validate_eosio.token_abi ...............   Passed    0.03 sec
      Start  4: validate_eosio.msig_abi
 4/31 Test  #4: validate_eosio.msig_abi ................   Passed    0.03 sec
      Start  5: validate_multi_index_test_abi
 5/31 Test  #5: validate_multi_index_test_abi ..........   Passed    0.03 sec
      Start  6: validate_eosio.system_abi
 6/31 Test  #6: validate_eosio.system_abi ..............   Passed    0.03 sec
      Start  7: validate_identity_abi
 7/31 Test  #7: validate_identity_abi ..................   Passed    0.03 sec
      Start  8: validate_identity_test_abi
 8/31 Test  #8: validate_identity_test_abi .............   Passed    0.03 sec
      Start  9: validate_currency_abi
 9/31 Test  #9: validate_currency_abi ..................   Passed    0.03 sec
      Start 10: validate_stltest_abi
10/31 Test #10: validate_stltest_abi ...................   Passed    0.03 sec
      Start 11: validate_exchange_abi
11/31 Test #11: validate_exchange_abi ..................   Passed    0.03 sec
      Start 12: validate_test.inline_abi
12/31 Test #12: validate_test.inline_abi ...............   Passed    0.03 sec
      Start 13: validate_asserter_abi
13/31 Test #13: validate_asserter_abi ..................   Passed    0.03 sec
      Start 14: validate_infinite_abi
14/31 Test #14: validate_infinite_abi ..................   Passed    0.03 sec
      Start 15: validate_proxy_abi
15/31 Test #15: validate_proxy_abi .....................   Passed    0.03 sec
      Start 16: validate_test_api_abi
16/31 Test #16: validate_test_api_abi ..................   Passed    0.03 sec
      Start 17: validate_test_api_mem_abi
17/31 Test #17: validate_test_api_mem_abi ..............   Passed    0.02 sec
      Start 18: validate_test_api_db_abi
18/31 Test #18: validate_test_api_db_abi ...............   Passed    0.03 sec
      Start 19: validate_test_api_multi_index_abi
19/31 Test #19: validate_test_api_multi_index_abi ......   Passed    0.03 sec
      Start 20: validate_eosio.bios_abi
20/31 Test #20: validate_eosio.bios_abi ................   Passed    0.03 sec
      Start 21: validate_noop_abi
21/31 Test #21: validate_noop_abi ......................   Passed    0.03 sec
      Start 22: validate_dice_abi
22/31 Test #22: validate_dice_abi ......................   Passed    0.03 sec
      Start 23: validate_tic_tac_toe_abi
23/31 Test #23: validate_tic_tac_toe_abi ...............   Passed    0.03 sec
      Start 24: chain_test_binaryen
24/31 Test #24: chain_test_binaryen ....................   Passed   52.40 sec
      Start 25: chain_test_wavm
25/31 Test #25: chain_test_wavm ........................   Passed  102.04 sec
      Start 26: nodeos_run_test
26/31 Test #26: nodeos_run_test ........................   Passed   57.08 sec
      Start 27: nodeos_run_remote_test
27/31 Test #27: nodeos_run_remote_test .................   Passed   84.29 sec
      Start 28: p2p_dawn515_test
28/31 Test #28: p2p_dawn515_test .......................   Passed    1.04 sec
      Start 29: nodeos_run_test-mongodb
29/31 Test #29: nodeos_run_test-mongodb ................   Passed   89.14 sec
      Start 30: distributed-transactions-test
30/31 Test #30: distributed-transactions-test ..........   Passed   59.62 sec
      Start 31: distributed-transactions-remote-test
31/31 Test #31: distributed-transactions-remote-test ...   Passed   65.65 sec

100% tests passed, 0 tests failed out of 31

Total Test time (real) = 511.91 sec
----

=== Appendix B - Default config.ini file
[source,bash]
----
# Track only transactions whose scopes involve the listed accounts. Default is to track all transactions. (eosio::account_history_plugin)
# filter_on_accounts =

# Limits the maximum time (in milliseconds) processing a single get_transactions call. (eosio::account_history_plugin)
get-transactions-time-limit = 3

# File to read Genesis State from (eosio::chain_plugin)
genesis-json = "genesis.json"

# override the initial timestamp in the Genesis State file (eosio::chain_plugin)
# genesis-timestamp =

# the location of the block log (absolute path or relative to application data dir) (eosio::chain_plugin)
block-log-dir = "blocks"

# Pairs of [BLOCK_NUM,BLOCK_ID] that should be enforced as checkpoints. (eosio::chain_plugin)
# checkpoint =

# Limits the maximum time (in milliseconds) that a reversible block is allowed to run before being considered invalid (eosio::chain_plugin)
max-reversible-block-time = -1

# Limits the maximum time (in milliseconds) that is allowed a pushed transaction's code to execute before being considered invalid (eosio::chain_plugin)
max-pending-transaction-time = -1

# Limits the maximum time (in milliseconds) that is allowed a to push deferred transactions at the start of a block (eosio::chain_plugin)
max-deferred-transaction-time = 20

# Override default WASM runtime (eosio::chain_plugin)
# wasm-runtime =

# Time to wait, in milliseconds, between creating next faucet created account. (eosio::faucet_testnet_plugin)
faucet-create-interval-ms = 1000

# Name to use as creator for faucet created accounts. (eosio::faucet_testnet_plugin)
faucet-name = faucet

# [public key, WIF private key] for signing for faucet creator account (eosio::faucet_testnet_plugin)
faucet-private-key = ["EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV","5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3"]

# The local IP and port to listen for incoming http connections. (eosio::http_plugin)
http-server-address = 127.0.0.1:8888

# Specify the Access-Control-Allow-Origin to be returned on each request. (eosio::http_plugin)
# access-control-allow-origin =

# Specify the Access-Control-Allow-Headers to be returned on each request. (eosio::http_plugin)
# access-control-allow-headers =

# Specify if Access-Control-Allow-Credentials: true should be returned on each request. (eosio::http_plugin)
access-control-allow-credentials = false

# The queue size between nodeos and MongoDB plugin thread. (eosio::mongo_db_plugin)
mongodb-queue-size = 256

# MongoDB URI connection string, see: https://docs.mongodb.com/master/reference/connection-string/. If not specified then plugin is disabled. Default database 'EOS' is used if not specified in URI. (eosio::mongo_db_plugin)
# mongodb-uri =

# The actual host:port used to listen for incoming p2p connections. (eosio::net_plugin)
p2p-listen-endpoint = 0.0.0.0:9876

# An externally accessible host:port for identifying this node. Defaults to p2p-listen-endpoint. (eosio::net_plugin)
# p2p-server-address =

# The public endpoint of a peer node to connect to. Use multiple p2p-peer-address options as needed to compose a network. (eosio::net_plugin)
# p2p-peer-address =

# The name supplied to identify this node amongst the peers. (eosio::net_plugin)
agent-name = "EOS Test Agent"

# Can be 'any' or 'producers' or 'specified' or 'none'. If 'specified', peer-key must be specified at least once. If only 'producers', peer-key is not required. 'producers' and 'specified' may be combined. (eosio::net_plugin)
allowed-connection = any

# Optional public key of peer allowed to connect.  May be used multiple times. (eosio::net_plugin)
# peer-key =

# Tuple of [PublicKey, WIF private key] (may specify multiple times) (eosio::net_plugin)
# peer-private-key =

# Log level: one of 'all', 'debug', 'info', 'warn', 'error', or 'off' (eosio::net_plugin)
log-level-net-plugin = info

# Maximum number of clients from which connections are accepted, use 0 for no limit (eosio::net_plugin)
max-clients = 25

# number of seconds to wait before cleaning up dead connections (eosio::net_plugin)
connection-cleanup-period = 30

# True to require exact match of peer network version. (eosio::net_plugin)
network-version-match = 0

# number of blocks to retrieve in a chunk from any individual peer during synchronization (eosio::net_plugin)
sync-fetch-span = 100

# Enable block production, even if the chain is stale. (eosio::producer_plugin)
enable-stale-production = false

# Percent of producers (0-100) that must be participating in order to produce blocks (eosio::producer_plugin)
required-participation = 33

# ID of producer controlled by this node (e.g. inita; may specify multiple times) (eosio::producer_plugin)
# producer-name =

# Tuple of [public key, WIF private key] (may specify multiple times) (eosio::producer_plugin)
private-key = ["EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV","5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3"]

# The path of the wallet files (absolute path or relative to application data dir) (eosio::wallet_plugin)
wallet-dir = "."

# Timeout for unlocked wallet in seconds. Wallets will automatically lock after specified number of seconds of inactivity. Activity is defined as any wallet command e.g. list-wallets. (eosio::wallet_plugin)
# unlock-timeout =

# eosio key that will be imported automatically when a wallet is created. (eosio::wallet_plugin)
# eosio-key =

# Plugin(s) to enable, may be specified multiple times
# plugin =
----

